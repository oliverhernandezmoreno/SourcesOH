# tranque-http-poller-producer

Tranque http-poller-producer is a program that runs forever and polls
an HTTP(S) endpoint, forwarding the received data to another HTTP(S)
endpoint.

## Usage

The request that fetches data and the interpretation of the response
is configured through a python script, which must be pointed to
through the `SCRIPT_FILE` environment variable. The script should
define two procedures:
- `build_request()` must be a no-parameters procedure that returns a
  generator of tuples of (url, query parameters dict, headers
  dict). The parameters will be used to issue the requests.
- `parse_response(response, url, params, headers)` must be a
  four-parameter procedure that transforms the response of the
  endpoint being polled into a collection of _events_, according to
  the JSON schema of the Tranque platform
  ([reference](https://gitlab.com/Inria-Chile/tranque/beats-consumer/blob/dev/event.jsonschema)). The
  `response` object will be one of
  [requests.Response](https://2.python-requests.org/en/master/api/#requests.Response). `url`,
  `params` and `headers` will be the same values generated by
  `build_request()`.

Another configuration variables are:
- `CONSUMER_ENDPOINT` the full path to the HTTP(S) endpoint that
  consumes events generated by the poller.
- `CONSUMER_PASSWORD` the mandatory password used to authenticate with
  the consumer.
- `POLL_INTERVAL` the interval in seconds used to space polling cycles
  evenly.
- `HEARTBEAT_NAME` the time series name used to monitor this poller.
- `HEARTBEAT_INTERVAL` the interval in seconds used to space heartbeat
  cycles evenly (defaults to `60`).
